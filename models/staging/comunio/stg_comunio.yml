version: 2

models:
  - name: stg_clubs
    description: Every club thats plays in the first Bundesliga is represented. 
    columns:
      - name: club_id
        tests: 
          - unique
          - not_null
        description: Club ID number
      - name: comunio_club_id
        tests:
          - unique
          - not_null
        description: Comunio Club ID
      - name: club_title
        tests:
          - unique
          - not_null
        description: Club title

  - name: stg_players
    description: Contains all players from every club in the bundesliga. Created from the latest infomration of the refrence table.
    columns:
      - name: player_id
        description: Player ID
        tests: 
          - unique
          - not_null
      - name: player_name
        description: Player name
        tests:
          - not_null
      - name: position
        description: Position in lineup
        tests:
          - accepted_values:
              values: ["Torwart", "Abwehr", "Mittelfeld", "Sturm"]
      - name: club_id
        description: Club ID
        tests:
          - not_null
          - relationships:
              field: club_id
              to: ref('stg_clubs')

  - name: stg_market_values
    description: Contains for each player for every loading date a market value. 
    columns:
      - name: market_value_id
        description: UUID market value 
        tests:
          - not_null
          - unique
      - name: player_id
        description: Player ID
        tests:
          - relationships:
              field: player_id
              to: ref('stg_players')
      - name: market_value
        description: Market value
      - name: loaded_date
        description: Date when market value was extracted and loaded into db.

  - name: stg_matches
    description: Contains all upcoming and played matches.
    columns:
      - name: matchday
        description: Matchday
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 34
      - name: match_date
        description: Date the match is scheduled.
        tests:
          - not_null 
      - name: match_id  
        tests:
          - not_null
          - unique
      - name: kickoff_time
        description: Time the kick off is scheduled. Not known for first matchdays.  
      - name: home_club_id
        description: Home Team's Club ID 
        tests:
          - not_null
          - relationships:
              field: club_id
              to: ref('stg_club')
      - name: away_club_id
        description: Away Team's Club ID 
        tests:
          - not_null
          - relationships:
              field: club_id
              to: ref('stg_club')          
      - name: home_club_title
        description: Home Club Title
        tests:
          - not_null
      - name: away_club_title
        description: Away Club Title
        tests:
          - not_null
      - name: goals_home
        description: Goals scored by the home team. Contains data only if a matches is played otherwise its null.
      - name: goals_away
        description: Goals scored by the away team. Contains data only if a matches is played otherwise its null.
      - name: expected_goals_home
        description: Expected goals by the home team. Contains data only if a matches is played otherwise its null.
      - name: expected_goals_away
        description: Expected goals scored by the away team. Contains data only if a matches is played otherwise its null.
      - name: match_status
        description: Match status
        tests:
          - accepted_values:
              values: ["upcoming", "finished"]
      - name: loaded_date
        description: Datetime the observation was loaded into the database.
              
